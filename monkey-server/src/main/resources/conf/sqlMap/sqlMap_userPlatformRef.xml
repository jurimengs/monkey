<?xml version="1.0" encoding="UTF-8" ?>
<sqlMap namespace="UserPlatformRef">
    <sql id="findEntityByUserId" isRead="true">
        <![CDATA[
            select * FROM `t_user_platform_ref` where company_id = :companyId and user_id = :userId
        ]]>
    </sql>
    <sql id="findEntityByPlatformId" isRead="true">
        <![CDATA[
            select *
            FROM
            `t_user_platform_ref` r
        LEFT JOIN wec_user u ON r.user_id = u.id
        WHERE
            r.company_id = :companyId
        AND r.platform_id = :platformId
        AND r.platform_type = :platformType
        AND u.`status` = 0
        AND u.user_status NOT IN ('50', '40')
        ]]>
    </sql>
    <sql id="findUserNotinPlatform" isRead="true">
        <![CDATA[
            SELECT
				id,company_id,user_name,organ_id,o.phone,o.email
			FROM
				wec_user o
			WHERE
				company_id = :companyId
			AND o.`status` = 0
			and o.user_status NOT IN ('50', '40')
			AND NOT EXISTS (
				SELECT
					1
				FROM
					t_user_platform_ref r
				WHERE
					r.company_id =:companyId
				AND o.id = r.user_id
			)
        ]]>
    </sql>


    <sql id="findEntityForSendMessasge" isRead="true">
        <![CDATA[
            select * FROM `t_user_platform_ref`
            where company_id = :companyId
            and user_id = :userId
           <#if platformType?? && platformType?length gt 0>
                 and platform_type =:platformType
            </#if>
        ]]>
    </sql>

    <sql id="batchUpdatePlatformId">
        <![CDATA[
            update t_user_platform_ref set platform_id=:wxId where platform_type=:platformType and  user_id=:userId and company_id=:companyId
        ]]>
    </sql>
    
    <sql id="deleteUserPlatformRef">
        <![CDATA[
            delete from t_user_platform_ref where platform_id=:platformId and company_id=:companyId
        ]]>
    </sql>
</sqlMap>
<?xml version="1.0" encoding="UTF-8" ?>
<sqlMap namespace="Talent">
    <sql id="InTalentCusInfo">
        <![CDATA[
			INSERT INTO ${tableName} 
		(id
		, company_id
		,uid
		<#if filedList??  && filedList?size gt 0>
            <#list filedList as filed>
            ,${filed}
        	</#list>
        </#if>
		)
		VALUES
		(:id
		, :companyId
		,:uid
		<#if valueList??  && valueList?size gt 0>
            <#list valueList as value>
            ,:value
        	</#list>
        </#if>
		)
		]]>
    </sql>
    
    <sql id="removeEmpEntryInfo">
        <![CDATA[
			DELETE
			FROM 
				${tableName}
			WHERE
				user_id = :userId
		]]>
    </sql>
    
    <sql id="updateTalentCusInfo">
        <![CDATA[
		UPDATE ${tableName} 
		set uid = :uid
		<#if filedList??  && filedList?size gt 0>
		<#list filedList as filed>
            ,${filed.filed} = ${filed.value}
        </#list>
		</#if>
		where uid = :uid
		]]>
    </sql>
    
    <sql id="getTalentBaseInfoById" isRead="true">
        <![CDATA[
		SELECT
			p.*, o.organ_name organName,
			g.gangwei_name gangweiName,
			z.id zhiweiId,
			zl.name zhijiName,
			z.zhiwei_name zhiweiName
		FROM
			t_talentpool p
		LEFT JOIN t_organ o ON p.organ_id = o.id
		LEFT JOIN t_gangwei g ON p.gangwei_id = g.id
		LEFT JOIN t_zhiwei z ON g.zhiwei_id = z.id
		LEFT JOIN t_zhiwei_level zl ON p.zhiji = zl.id
		WHERE
			p.id = :id
		]]>
    </sql>
    
    <sql id="getEmpFamily" isRead="true">
        <![CDATA[
			SELECT
				id,
				name,
				relation,
				phone,
				remark
			FROM
				t_emp_family
			WHERE
				user_id = :userId
		]]>
    </sql>
    
    <sql id="getEmpEdu" isRead="true">
        <![CDATA[
		SELECT
			id,
			school,
			start_date startDate,
			end_date endDate,
			remark,
			major,
			edu_level eduLevel
		FROM
			t_emp_edu
		WHERE
			user_id = :userId
		]]>
    </sql>
    
    <sql id="getEmpWorkexp" isRead="true">
        <![CDATA[
			SELECT
				id,
				company,
				zhiwei,
				start_date startDate,
				end_date endDate,
				remark,
				confir_mem confirMem,
				confir_phone confirPhone
			FROM
				t_emp_workexp
			WHERE
				user_id = :userId
		]]>
    </sql>
    
    <sql id="getEmpSocial" isRead="true">
        <![CDATA[
			SELECT
				id,
				social_account socialAccount,
				social_start_date socialStartDate,
				gongjijin_account gongjijinAccount,
				gongjijin_start_date gongjijinStartDate,
				social_base socialBase,
				gongjijin_base gognjijinBase,
				social_province socialProvince,
				social_city socialCity,
				social_area socialArea,
				gongjijin_province gongjijinProvince,
				gongjijin_city gongjijinCity,
				gongjijin_area gongjijinArea
			FROM
				t_emp_social
			WHERE
				user_id = :userId
		]]>
    </sql>
    
    <sql id="getEmpCommercialInsurance" isRead="true">
        <![CDATA[
			SELECT
				id,
				enter_date enterDate,
				commer_type commerType,
				enter_insurance_number enterInsuranceNumber,
				order_number orderNumber,
				exit_date exitDate
			FROM
				t_emp_commercial_insurance
			WHERE
				user_id = :userId
		]]>
    </sql>
    
    
    <sql id="getEmpEntryInfo" isRead="true">
        <![CDATA[
			SELECT
				id,
				data_type dataType,
				data_status dataStatus,
				data_addr dataAddr
			FROM
				t_emp_entry_info
			WHERE
				user_id = :userId
		]]>
    </sql>
    
    <sql id="removeEmpEntryInfo">
        <![CDATA[
			DELETE
			FROM
				t_emp_entry_info
			WHERE
				user_id = :userId
		]]>
    </sql>
    
    <sql id="getEmpHealthy" isRead="true">
        <![CDATA[
			SELECT
				id,
				check_date checkDate,
				height,
				weight,
				heart_beat heartBeat,
				min_pressure minPressure,
				max_pressure maxPressure,
				remark,
				advantage,
				disadvantage
			FROM
				t_emp_healthy
			WHERE
				user_id = :userId
		]]>
    </sql>
    <sql id="getEmpXiaoxinyanglao" isRead="true">
        <![CDATA[
			SELECT
				id,
				start_date startDate,
				NAME,
				pnid_type pnidType,
				pnid,
				bank_id bankId
			FROM
				t_emp_xiaoxinyanglao
			WHERE
				user_id = :userId
		]]>
    </sql>
    <sql id="getEmpXiaoxinyanglaoVisit" isRead="true">
        <![CDATA[
			SELECT
				id,
				visitor,
				visit_date visitDate,
				visit_content visitContent
			FROM
				t_emp_xiaoxinyanglao_visit
			WHERE
				user_id = :userId
		]]>
    </sql>
	
	<sql id="checkTalentByPnId" isRead="true">
	        <![CDATA[
			SELECT
				COUNT(1)
			FROM
				t_talentpool 
			WHERE
				company_id = :companyId
			
			AND pnid = :pnId
			]]>
	</sql>
	<sql id="getTanlentByPnId" isRead="true">
	        <![CDATA[
			SELECT
				*
			FROM
				t_talentpool 
			WHERE
				company_id = :companyId
			
			AND pnid = :pnId
			]]>
	</sql>
	<sql id="deleteTalentInfoByUserId" >
	        <![CDATA[
			DELETE 
				FROM ${tableName}
			WHERE  
			 user_id IN (:idList)
			]]>
	</sql>
	<sql id="deleteTalentInfoById" >
	        <![CDATA[
			DELETE 
				FROM ${tableName}
			WHERE  
				id IN (:idList)
			]]>
	</sql>
	<sql id="deleteTalentByPnId" >
	        <![CDATA[
			DELETE 
				FROM t_talentpool
			WHERE  
				pnid = :pnId
				and company_id = :companyId
			]]>
	</sql>
	<sql id="getTalentByKeyWord" isRead="true">
	        <![CDATA[
			SELECT
				t.id,
				t.user_name userName,
				t.emp_no empNo,
				g.gangwei_name gangweiName,
				o.organ_name organName,
				o.id organId,
				t.id_type idType,
				t.pnid
			FROM
				t_talentpool t
			left join t_gangwei g on t.gangwei_id = g.id
			left join t_organ o on t.organ_id = o.id
			WHERE
			 	t.company_id = :companyId
			AND t.user_name like CONCAT('%',:userName,'%')
			]]>
	</sql>
	
	<sql id="getCountTalent" isRead="true">
        <![CDATA[
		SELECT
				COUNT(1)
		FROM
			t_talentpool p
		LEFT JOIN t_organ o ON o.id = p.organ_id
		LEFT JOIN t_gangwei g ON g.id = p.gangwei_id
		LEFT JOIN t_zhiwei z ON z.id = g.zhiwei_id
		LEFT JOIN wec_user u ON u.id = p.update_uid
		WHERE
			p.company_id = :companyId
		<#if key??  && key?length gt 0>
		AND (
			o.organ_name LIKE CONCAT('%', :key, '%')
		OR g.gangwei_name LIKE CONCAT('%', :key, '%')
		OR p.user_name LIKE CONCAT('%', :key, '%')
		)
		</#if>
		
  		<#switch condition>
	        <#case 1>
	        <#case 2>
	            AND p.pastwork_status = :pastWorkStatus
	            <#break>
	        <#case 3>
            <#case 4>
	            AND p.create_date > :date 
	            <#break>
	        <#default>
	             AND 1=1
   		</#switch>
	
		<#if functions??  && functions?size gt 0>
			and (
           	<#list functions as thisfunc>
           		<#if thisfunc??  && thisfunc?size gt 0>
           		 	(
           		 	<#list thisfunc as selffunc>
           		 			${selffunc.sqlStr}  
           		 			 	<#if selffunc.funcType??  && selffunc.funcType?length gt 0> 
           		 			 		<#if selffunc.funcType = 0>
           		 			 			<
           		 			 		</#if> 
           		 			 		<#if selffunc.funcType = 1>
           		 			 			=
           		 			 		</#if> 
           		 			 		<#if selffunc.funcType = 2>
           		 			 			>
           		 			 		</#if> 
           		 			 	<#else>
           		 			 	 like
								</#if>  
           		 			'${selffunc.funcValue}'
           		 		<#if selffunc_has_next> and</#if>
           		 	</#list>	           		 		           	       
          		 		)
          		 		<#if thisfunc_has_next> or </#if>
          		 	</#if>          		 	
       		</#list>
       		)
      	</#if>
		]]>
	</sql>
	
	<sql id="getTalentPage" isRead="true">
        <![CDATA[
		SELECT
			p.id,
			p.pnid,
			p.user_name userName,
			p.phone,
			p.organ_id organId,
			o.organ_name organName,
			p.gangwei_id gangweiId,
			g.gangwei_name gangweiName,
			g.zhiwei_id zhiweiId,
			z.zhiwei_name zhiweiName,
			p.entry_date entryDate,
			p.id_type idType,
			p.update_uid updateUid,
			u.user_name updateUserName,
			p.update_date updateDate,
			p.create_date createDate
			<#if selfFields??  && selfFields?size gt 0>
			,
            	<#list selfFields as selfField>
           		 	ext.${selfField}
           		 	<#if selfField_has_next>,</#if>
        		</#list>
       		</#if>
		FROM
			t_talentpool p
		LEFT JOIN t_organ o ON o.id = p.organ_id
		LEFT JOIN t_gangwei g ON g.id = p.gangwei_id
		LEFT JOIN t_zhiwei z ON z.id = g.zhiwei_id
		LEFT JOIN wec_user u ON u.id = p.update_uid
		WHERE
			p.company_id = :companyId
		<#if key??  && key?length gt 0>
		AND (
			o.organ_name LIKE CONCAT('%', :key, '%')
		OR g.gangwei_name LIKE CONCAT('%', :key, '%')
		OR p.user_name LIKE CONCAT('%', :key, '%')
		)
		</#if>
		
  		<#switch condition>
	        <#case 1>
	        <#case 2>
	            AND p.pastwork_status = :pastWorkStatus
	            <#break>
	        <#case 3>
            <#case 4>
	            AND p.create_date > :date 
	            <#break>
	        <#default>
	             AND 1=1
   		</#switch>
	
		<#if functions??  && functions?size gt 0>
			and (
           	<#list functions as thisfunc>
           		<#if thisfunc??  && thisfunc?size gt 0>
           		 	(
           		 	<#list thisfunc as selffunc>
           		 			${selffunc.sqlStr}  
           		 			 	<#if selffunc.funcType??  && selffunc.funcType?length gt 0> 
           		 			 		<#if selffunc.funcType = 0>
           		 			 			<
           		 			 		</#if> 
           		 			 		<#if selffunc.funcType = 1>
           		 			 			=
           		 			 		</#if> 
           		 			 		<#if selffunc.funcType = 2>
           		 			 			>
           		 			 		</#if> 
           		 			 	<#else>
           		 			 	 like
								</#if>  
           		 			'${selffunc.funcValue}'
           		 		<#if selffunc_has_next> and</#if>
           		 	</#list>	           		 		           	       
          		 		)
          		 		<#if thisfunc_has_next> or </#if>
          		 	</#if>          		 	
       		</#list>
       		)
      	</#if>
		ORDER BY p.update_date desc
		]]>
	</sql>
</sqlMap>

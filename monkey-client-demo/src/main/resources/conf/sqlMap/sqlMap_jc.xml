<?xml version="1.0" encoding="UTF-8" ?>
<sqlMap namespace="Jc">
	<sql id="getJcList" isRead="true">
        <![CDATA[
       SELECT
			j.id,
			u.user_name userName,
			u.emp_no empNo,
			j.effect_date effectDate,
			j.jc_type jcType,
			j.jc_name jcName,
			j.status,
			j.jc_money jcMoney,
			j.jc_score jcScore,
			j.jc_reason jcReason,
			j.remark,
			j.company_id companyId,
			j.process_id processId,
			j.create_uid createUid,
			uu.user_name updateName,
			DATE_FORMAT(j.update_date, '%Y-%m-%d') AS updateDate
			<#if selfFields??  && selfFields?size gt 0>
                ,
                <#list selfFields as selfField>
                    ext.${selfField}
                    <#if selfField_has_next>,</#if>
                </#list>
            </#if>
		FROM
			t_emp_jc j
		LEFT JOIN t_ext_t_emp_jc ext ON j.id = ext.id
		LEFT JOIN wec_user u ON j.user_id = u.id
		LEFT JOIN t_organ o on u.organ_id = o.id
		LEFT JOIN wec_user uu ON j.update_uid = uu.id
		WHERE
			j.company_id = :companyId
			and j.status != '5'
		<#if path??  && path?length gt 0>
			AND o.organ_paths LIKE concat(:path, '%')
		</#if>
		<#if navigation??  && navigation?length gt 0>
	        <#switch navigation>
	        <#case 1>
	        and j.status = '10'
	         <#break>
	        <#case 2>
	         and j.status = '60'
	         <#break>
	        <#case 3>
	         and j.status in('20','30')
	         <#break>
	         <#case 4>
	       	 and j.status = '70'
	         <#break>
	         <#default>
	         </#switch>
	       	</#if>
		<#if key??  && key?length gt 0>
		AND (
			u.user_name LIKE CONCAT('%', :key, '%')
			OR u.emp_no LIKE CONCAT('%', :key, '%')
		)
		</#if>
		<#if dataRange??  && dataRange?length gt 0>
			${dataRange}
		</#if>
		 <#if functions??  && functions?size gt 0>
                AND(
                <#list functions as thisfunc>
                    <#if thisfunc??  && thisfunc?size gt 0>
                        (
                        <#list thisfunc as selffunc>
                            ${selffunc.sqlStr}
                            <#if selffunc.funcType??  && selffunc.funcType?length gt 0>
                                <#if selffunc.funcType = 0>
                                    <
                                </#if>
                                <#if selffunc.funcType = 1>
                                    =
                                </#if>
                                <#if selffunc.funcType = 2>
                                    >
                                </#if>
                                <#else>
                                    like
                                </#if>
                                '${selffunc.funcValue}'
                            <#if selffunc_has_next> and</#if>
                        </#list>
                        )
                        <#if thisfunc_has_next> or </#if>
                    </#if>
                </#list>
                )
            </#if>
        ]]>
	</sql>

	<sql id="InEmpJcExtInfo">
        <![CDATA[
		INSERT INTO t_ext_t_emp_jc
		(id
		, company_id
		<#if filedList??  && filedList?size gt 0>
            <#list filedList as filed>
            ,${filed}
        	</#list>
        </#if>
		)
		VALUES
		(:id
		, :companyId
		<#if valueList??  && valueList?size gt 0>
            <#list valueList as value>
            ,'${value}'
        	</#list>
        </#if>
		)
			]]>
	</sql>

	<sql id="updateEmpJcExtInfo">
        <![CDATA[
		UPDATE t_ext_t_emp_jc
		SET
		id = :id
		<#if filesValue??  && filesValue?size gt 0>
            <#list filesValue as filed>
            ,${filed.filed} = '${filed.value}'
        	</#list>
        </#if>
		WHERE
			id = :id
			]]>
	</sql>
	
	<sql id="getJcInfo" isRead="true">
        <![CDATA[
        SELECT
			j.id,
			u.user_name userName,
			j.user_id userId,
			j.effect_date effectDate,
			j.jc_type jcType,
			j.status,
			j.jc_name jcName,
			j.jc_money jcMoney,
			j.jc_score jcScore,
			j.jc_reason jcReason,
			j.remark,
			j.company_id companyId,
			j.process_id processId,
			j.stage_num stageNum,
			j.stage_money stageMoney
			<#if customFieldList??  && customFieldList?size gt 0>
                    ,
                    <#list customFieldList as selfField>
                        ext.${selfField.fieldName}
                        <#if selfField_has_next>,</#if>
                    </#list>
                </#if>
		FROM
			t_emp_jc j
		LEFT JOIN t_ext_t_emp_jc ext ON j.id = ext.id
		LEFT JOIN wec_user u ON j.user_id = u.id
		WHERE
			j.id = :id
        ]]>
	</sql>

	<sql id="getJcNavigationBarCount" isRead="true">
        <![CDATA[
    	 select * from (SELECT COUNT(*) allCount FROM
			t_emp_jc j
		LEFT JOIN t_ext_t_emp_jc ext ON j.id = ext.id
		LEFT JOIN wec_user u ON j.user_id = u.id
		LEFT JOIN t_organ o on u.organ_id = o.id
		LEFT JOIN wec_user uu ON j.create_uid = uu.id
		WHERE
			j.company_id = :companyId
			and j.status != '5'
		<#if path??  && path?length gt 0>
			AND o.organ_paths LIKE concat(:path, '%')
		</#if>
		<#if key??  && key?length gt 0>
		AND (
			u.user_name LIKE CONCAT('%', :key, '%')
			OR u.emp_no LIKE CONCAT('%', :key, '%')
		)
		</#if>
		<#if dataRange??  && dataRange?length gt 0>
			${dataRange}
		</#if>
		<#if functions??  && functions?size gt 0>
                AND(
                <#list functions as thisfunc>
                    <#if thisfunc??  && thisfunc?size gt 0>
                        (
                        <#list thisfunc as selffunc>
                            ${selffunc.sqlStr}
                            <#if selffunc.funcType??  && selffunc.funcType?length gt 0>
                                <#if selffunc.funcType = 0>
                                    <
                                </#if>
                                <#if selffunc.funcType = 1>
                                    =
                                </#if>
                                <#if selffunc.funcType = 2>
                                    >
                                </#if>
                                <#else>
                                    like
                                </#if>
                                '${selffunc.funcValue}'
                            <#if selffunc_has_next> and</#if>
                        </#list>
                        )
                        <#if thisfunc_has_next> or </#if>
                    </#if>
                </#list>
                )
            </#if>) a,
            (SELECT COUNT(*) approvalCount FROM
			t_emp_jc j
		LEFT JOIN t_ext_t_emp_jc ext ON j.id = ext.id
		LEFT JOIN wec_user u ON j.user_id = u.id
		LEFT JOIN t_organ o on u.organ_id = o.id
		LEFT JOIN wec_user uu ON j.create_uid = uu.id
		WHERE
			j.company_id = :companyId
			and j.status = '10'
		<#if path??  && path?length gt 0>
			AND o.organ_paths LIKE concat(:path, '%')
		</#if>
		<#if key??  && key?length gt 0>
		AND (
			u.user_name LIKE CONCAT('%', :key, '%')
			OR u.emp_no LIKE CONCAT('%', :key, '%')
		)
		</#if>
		<#if dataRange??  && dataRange?length gt 0>
			${dataRange}
		</#if>
		<#if functions??  && functions?size gt 0>
                AND(
                <#list functions as thisfunc>
                    <#if thisfunc??  && thisfunc?size gt 0>
                        (
                        <#list thisfunc as selffunc>
                            ${selffunc.sqlStr}
                            <#if selffunc.funcType??  && selffunc.funcType?length gt 0>
                                <#if selffunc.funcType = 0>
                                    <
                                </#if>
                                <#if selffunc.funcType = 1>
                                    =
                                </#if>
                                <#if selffunc.funcType = 2>
                                    >
                                </#if>
                                <#else>
                                    like
                                </#if>
                                '${selffunc.funcValue}'
                            <#if selffunc_has_next> and</#if>
                        </#list>
                        )
                        <#if thisfunc_has_next> or </#if>
                    </#if>
                </#list>
                )
            </#if>) b,
             (SELECT COUNT(*) passCount FROM
			t_emp_jc j
		LEFT JOIN t_ext_t_emp_jc ext ON j.id = ext.id
		LEFT JOIN wec_user u ON j.user_id = u.id
		LEFT JOIN t_organ o on u.organ_id = o.id
		LEFT JOIN wec_user uu ON j.create_uid = uu.id
		WHERE
			j.company_id = :companyId
			and j.status = '60'
		<#if path??  && path?length gt 0>
			AND o.organ_paths LIKE concat(:path, '%')
		</#if>
		<#if key??  && key?length gt 0>
		AND (
			u.user_name LIKE CONCAT('%', :key, '%')
			OR u.emp_no LIKE CONCAT('%', :key, '%')
		)
		</#if>
		<#if dataRange??  && dataRange?length gt 0>
			${dataRange}
		</#if>
		 <#if functions??  && functions?size gt 0>
                AND(
                <#list functions as thisfunc>
                    <#if thisfunc??  && thisfunc?size gt 0>
                        (
                        <#list thisfunc as selffunc>
                            ${selffunc.sqlStr}
                            <#if selffunc.funcType??  && selffunc.funcType?length gt 0>
                                <#if selffunc.funcType = 0>
                                    <
                                </#if>
                                <#if selffunc.funcType = 1>
                                    =
                                </#if>
                                <#if selffunc.funcType = 2>
                                    >
                                </#if>
                                <#else>
                                    like
                                </#if>
                                '${selffunc.funcValue}'
                            <#if selffunc_has_next> and</#if>
                        </#list>
                        )
                        <#if thisfunc_has_next> or </#if>
                    </#if>
                </#list>
                )
            </#if>) c,
             (SELECT COUNT(*) refuseCount FROM
			t_emp_jc j
		LEFT JOIN t_ext_t_emp_jc ext ON j.id = ext.id
		LEFT JOIN wec_user u ON j.user_id = u.id
		LEFT JOIN t_organ o on u.organ_id = o.id
		LEFT JOIN wec_user uu ON j.create_uid = uu.id
		WHERE
			j.company_id = :companyId
			and j.status in('20','30')
		<#if path??  && path?length gt 0>
			AND o.organ_paths LIKE concat(:path, '%')
		</#if>
		<#if key??  && key?length gt 0>
		AND (
			u.user_name LIKE CONCAT('%', :key, '%')
			OR u.emp_no LIKE CONCAT('%', :key, '%')
		)
		</#if>
		<#if dataRange??  && dataRange?length gt 0>
			${dataRange}
		</#if>
		<#if functions??  && functions?size gt 0>
                AND(
                <#list functions as thisfunc>
                    <#if thisfunc??  && thisfunc?size gt 0>
                        (
                        <#list thisfunc as selffunc>
                            ${selffunc.sqlStr}
                            <#if selffunc.funcType??  && selffunc.funcType?length gt 0>
                                <#if selffunc.funcType = 0>
                                    <
                                </#if>
                                <#if selffunc.funcType = 1>
                                    =
                                </#if>
                                <#if selffunc.funcType = 2>
                                    >
                                </#if>
                                <#else>
                                    like
                                </#if>
                                '${selffunc.funcValue}'
                            <#if selffunc_has_next> and</#if>
                        </#list>
                        )
                        <#if thisfunc_has_next> or </#if>
                    </#if>
                </#list>
                )
            </#if>) d,
            (SELECT COUNT(*) autoPassCount FROM
			t_emp_jc j
		LEFT JOIN t_ext_t_emp_jc ext ON j.id = ext.id
		LEFT JOIN wec_user u ON j.user_id = u.id
		LEFT JOIN t_organ o on u.organ_id = o.id
		LEFT JOIN wec_user uu ON j.create_uid = uu.id
		WHERE
			j.company_id = :companyId
			and j.status = '70'
		<#if path??  && path?length gt 0>
			AND o.organ_paths LIKE concat(:path, '%')
		</#if>
		<#if key??  && key?length gt 0>
		AND (
			u.user_name LIKE CONCAT('%', :key, '%')
			OR u.emp_no LIKE CONCAT('%', :key, '%')
		)
		</#if>
		<#if dataRange??  && dataRange?length gt 0>
			${dataRange}
		</#if>
		 <#if functions??  && functions?size gt 0>
                AND(
                <#list functions as thisfunc>
                    <#if thisfunc??  && thisfunc?size gt 0>
                        (
                        <#list thisfunc as selffunc>
                            ${selffunc.sqlStr}
                            <#if selffunc.funcType??  && selffunc.funcType?length gt 0>
                                <#if selffunc.funcType = 0>
                                    <
                                </#if>
                                <#if selffunc.funcType = 1>
                                    =
                                </#if>
                                <#if selffunc.funcType = 2>
                                    >
                                </#if>
                                <#else>
                                    like
                                </#if>
                                '${selffunc.funcValue}'
                            <#if selffunc_has_next> and</#if>
                        </#list>
                        )
                        <#if thisfunc_has_next> or </#if>
                    </#if>
                </#list>
                )
            </#if>) e
        ]]>
	</sql>

	<sql id="getUserJcList" isRead="true">
        <![CDATA[
       SELECT
			j.id,
			u.user_name userName,
			u.emp_no empNo,
			j.effect_date effectDate,
			j.jc_type jcType,
			j.jc_name jcName,
			j.jc_money jcMoney,
			j.jc_score jcScore,
			j.jc_reason jcReason,
			j.remark,
			j.company_id companyId,
			j.process_id processId

		FROM
			t_emp_jc j
		LEFT JOIN wec_user u ON j.user_id = u.id
		WHERE
			j.company_id = :companyId
			AND j.user_id = :userId
			AND j.jc_type = :jcType
			<#if jcName?? && jcName gt 0>
	        	AND j.jc_name = :jcName
       		</#if>
       		<#if stratDate?? && stratDate?length gt 0>
	        	AND j.create_date >= :stratDate
       		</#if>
       		<#if endDate?? && endDate?length gt 0>
	        	AND j.create_date <= :endDate
       		</#if>
        ]]>
	</sql>

	<sql id="importJc">
        <![CDATA[
      INSERT INTO t_emp_jc (
			id,
			user_id,
			effect_date,
			remark,
			jc_type,
			jc_name,
			jc_money,
			jc_score,
			jc_reason,
			stage_num,
			stage_money.
			company_id,
			create_uid,
			update_uid,
			create_date,
			update_date,
			STATUS
		) VALUES
		<#if jcInfos?? && jcInfos?size gt 0>
                 <#list jcInfos as jcInfo>
                        (
                        '${jcInfo.id}',
                        '${jcInfo.userId}',
                        '${jcInfo.effectDate}',
                        '${jcInfo.remark}',
                        '${jcInfo.jcType}',
                        '${jcInfo.jcName}',
                        '${jcInfo.jcMoney}',
                        '${jcInfo.jcScore}', 
                        '${jcInfo.jcReason}',
                        '${jcInfo.stageNum}',
                        '${jcInfo.stageMoney}',
                        :companyId,  
                        :createUid,
                        :createUid,
                        :now,
                        :now,
                        :status
                        )
                  <#if jcInfo_has_next>,</#if>
                  </#list>
        </#if>
        ]]>
	</sql>

	<sql id="importJcDetail">
		<![CDATA[
      INSERT INTO t_emp_jc_info (
			jc_id,
			year,
			month,
			jc_type,
			jc_name,
			jc_money,
			jc_score
		) VALUES
		<#if jcDetails?? && jcDetails?size gt 0>
                 <#list jcDetails as jcInfo>
                        (
                        '${jcInfo.jcId}',
                        '${jcInfo.year}',
                        '${jcInfo.month}',
                        '${jcInfo.jcType}',
                        '${jcInfo.jcName}',
                        '${jcInfo.jcMoney}',
                        '${jcInfo.jcScore}'
                        )
                  <#if jcInfo_has_next>,</#if>
                  </#list>
        </#if>
        ]]>
	</sql>
</sqlMap>

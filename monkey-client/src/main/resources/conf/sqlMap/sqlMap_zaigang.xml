<?xml version="1.0" encoding="UTF-8" ?>
<sqlMap namespace="Zaigang">
	<sql id="countShidao" isRead="true">
        <![CDATA[
			select count(1) from wec_user u where u.company_id = :companyId
			and EXISTS (
                select 1 from t_kq_daka kd WHERE u.id = kd.user_id and DATE_FORMAT(kd.create_date, '%Y-%m-%d')  = :pbDate 
            )
            
            <#if organIds?? && organIds?size gt 0>
                and u.organ_id in (:organIds) 
            </#if>
			<#if workType?? && workType?length gt 0>
                and (
                    u.work_type = :workType
                )
            </#if>
			<#if keyword?? && keyword?length gt 0>
                and (
                    u.user_name like concat('%',:keyword,'%')
                )
            </#if>
            <#if dataRange??  && dataRange?length gt 0>
                ${dataRange}
            </#if>
        ]]>
	</sql>
	
	<sql id="countWeidao" isRead="true">
        <![CDATA[
			
            select count(1) from wec_user u where u.company_id = :companyId
            and not EXISTS (
                select 1 from t_kq_daka kd WHERE u.id = kd.user_id and DATE_FORMAT(kd.create_date, '%Y-%m-%d') = :pbDate 
            )
            
            <#if organIds?? && organIds?size gt 0>
                and u.organ_id in (:organIds) 
            </#if>
            <#if workType?? && workType?length gt 0>
                and (
                    u.work_type = :workType
                )
            </#if>
            <#if keyword?? && keyword?length gt 0>
                and (
                    u.user_name like concat('%',:keyword,'%')
                )
            </#if>
            <#if dataRange??  && dataRange?length gt 0>
                ${dataRange}
            </#if>
        ]]>
	</sql>
	
	<sql id="countYingdao" isRead="true">
        <![CDATA[
			select count(pb.user_id) from wec_user u 
			join t_paiban pb on pb.user_id = u.id
			where 
			u.company_id = :companyId and pb.pb_date = :pbDate
			and pb.banci_id <> (1 or '')

            <#if organIds?? && organIds?size gt 0>
                and u.organ_id in (:organIds) 
            </#if>
			<#if workType?? && workType?length gt 0>
                and (
                    u.work_type = :workType
                )
            </#if>
			<#if keyword?? && keyword?length gt 0>
                and (
                    u.user_name like concat('%',:keyword,'%')
                )
            </#if>
            <#if dataRange??  && dataRange?length gt 0>
                ${dataRange}
            </#if>
        ]]>
	</sql>

    <sql id="shidaoList" isRead="true">
        <![CDATA[
            select u.id as userId, u.user_name as userName, g.gangwei_name as gangweiName, pb.banci_id as banciId
            from wec_user u 
            left join t_gangwei g on g.id = u.gangwei_id
            left join t_paiban pb on pb.user_id = u.id
            where u.company_id = :companyId
            
            and EXISTS (
                select 1 from t_kq_daka kd WHERE u.id = kd.user_id and DATE_FORMAT(kd.create_date, '%Y-%m-%d')  = :pbDate 
            )
            
            <#if organIds?? && organIds?size gt 0>
                and u.organ_id in (:organIds) 
            </#if>
            <#if workType?? && workType?length gt 0>
                and (
                    u.work_type = :workType
                )
            </#if>
            <#if keyword?? && keyword?length gt 0>
                and (
                    u.user_name like concat('%',:keyword,'%')
                )
            </#if>
            <#if dataRange??  && dataRange?length gt 0>
                ${dataRange}
            </#if>
        ]]>
    </sql>

<!-- 未到 not exist -->
    <sql id="weidaoList" isRead="true">
        <![CDATA[
            select u.id as userId, u.user_name as userName, g.gangwei_name as gangweiName, pb.banci_id as banciId
            from wec_user u 
            left join t_gangwei g on g.id = u.gangwei_id
            left join t_paiban pb on pb.user_id = u.id
            where u.company_id = :companyId
            
            and not EXISTS (
                select 1 from t_kq_daka kd WHERE u.id = kd.user_id and DATE_FORMAT(kd.create_date, '%Y-%m-%d')  = :pbDate 
            )
            
            <#if organIds?? && organIds?size gt 0>
                and u.organ_id in (:organIds) 
            </#if>
            <#if workType?? && workType?length gt 0>
                and (
                    u.work_type = :workType
                )
            </#if>
            <#if keyword?? && keyword?length gt 0>
                and (
                    u.user_name like concat('%',:keyword,'%')
                )
            </#if>
            <#if dataRange??  && dataRange?length gt 0>
                ${dataRange}
            </#if>
        ]]>
    </sql>

    <!-- 应到算的是排了班的那些人 -->
    <sql id="yingdaoList" isRead="true">
        <![CDATA[
            select u.id as userId, u.user_name as userName, g.gangwei_name as gangweiName, pb.banci_id as banciId
            from wec_user u 
            left join t_gangwei g on g.id = u.gangwei_id
            left join t_paiban pb on pb.user_id = u.id
            where u.company_id = :companyId and pb.pb_date = :pbDate
            and pb.banci_id <> (1 or '')
            
            <#if organIds?? && organIds?size gt 0>
                and u.organ_id in (:organIds) 
            </#if>
            <#if workType?? && workType?length gt 0>
                and (
                    u.work_type = :workType
                )
            </#if>
            <#if keyword?? && keyword?length gt 0>
                and (
                    u.user_name like concat('%',:keyword,'%')
                )
            </#if>
            <#if dataRange??  && dataRange?length gt 0>
                ${dataRange}
            </#if>
        ]]>
    </sql>
</sqlMap>
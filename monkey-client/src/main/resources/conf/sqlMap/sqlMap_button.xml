<?xml version="1.0" encoding="UTF-8" ?>
<sqlMap namespace="Button">
    <!-- 根据权限查功能列表 -->
    <sql id="findButtonByRoleIds" isRead="true">
        <![CDATA[
        select b.* 
		from wec_permission_function pf 
		join wec_role_permission rp on pf.id = rp.permission_id
		join t_button b on pf.function_id = b.id 
		where pf.function_type = 2
		<#if companyId?? && companyId?size gt 0>
            AND rp.company_id = :companyId
        </#if>
        <#if roleIdList?? && roleIdList?size gt 0>
            AND rp.role_id in (:roleIdList)
        </#if>
		group by b.id
		order by b.sort asc
        ]]>
    </sql>
    
    <sql id="findBtnAll" isRead="true">
        <![CDATA[
            SELECT * FROM t_button
        ]]>
    </sql>

    <sql id="findByBtnCode" isRead="true">
        <![CDATA[
            SELECT id, menu_id, btn_name, btn_code, sort, remark, create_date FROM t_button
            WHERE btn_code = :btnCode
            LIMIT 1
        ]]>
    </sql>
    
    <sql id ="getButtonNameByButtonCodes" isRead = "true">
    	SELECT
			CONCAT(
				m.menu_name,
				'的',
				b.btn_name
			)
		FROM
			t_button b
		LEFT JOIN t_menu m ON b.menu_id = m.id
		WHERE
			b.btn_code IN (:btnCode)
    </sql>
    
    <sql id ="getAllMenuAndButtonName" isRead = "true">
    	SELECT
    		b.btn_code buttonCode,
			CONCAT(
				m.menu_name,
				'无法操作【',
				b.btn_name,
				'】'
			) buttonName
		FROM
			t_button b
		LEFT JOIN t_menu m ON b.menu_id = m.id
    </sql>
    
    <sql id ="getParmaCheckList" isRead = "true">
		SELECT
			b.btn_code buttonCode,
			p.param_name paramName,
			p.param_value paramValue,
			p.param_set paramSet,
			p.method_name methodName
		FROM
			t_cxy_param_premission p
		LEFT JOIN t_button b ON b.id = p.button_id
		where p.method_name = :methodName
    </sql>
</sqlMap>

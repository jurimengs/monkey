<?xml version="1.0" encoding="UTF-8" ?>
<sqlMap namespace="PersonnelRule">
	<sql id="findEmpNoRuleByCompanyId">
		<![CDATA[
			SELECT
				r.id id,
				r.organ_id organId,
				r.rule_type ruleType,
				r.prefix_type prefixType,
				r.prefix,
				(select MAX(suffix) from t_empno_rule where company_id = :companyId) suffix,
				r.kaoqin_no kaoqinNo,
				o.pid organPid,
				organ_type organType
			FROM
				t_empno_rule r
			LEFT JOIN t_organ o ON r.organ_id = o.id
			WHERE
				r.company_id = :companyId
		]]>
	</sql>
	
	<sql id="getempNoRulePage" isRead="true">
		<![CDATA[
			SELECT
				t_empno_rule.*
			FROM
				t_empno_rule
			WHERE
				t_empno_rule.company_id = :companyId
			AND t_empno_rule.organ_id= :organId
			ORDER BY t_empno_rule.update_date desc 
		]]>
	</sql>
	<sql id="getShigangRuleRangeByRuleId" isRead="true">
		<![CDATA[
			SELECT
			r.rule_id ruleId,
			r.`range`,
			r.range_type rangeType,
			u.user_name rangeName,
			u.id organId,
			'' zhileiName
			FROM
				t_shigang_rule_range r
			LEFT JOIN wec_user u ON r.`range` = u.id
			LEFT JOIN t_shigang_rule sr ON r.rule_id = sr.id
			WHERE
				r.range_type = 1
			AND r.rule_id =:ruleId
			AND sr.`status` != 5
			UNION
			SELECT
				r.rule_id ruleId,
				r.`range`,
				r.range_type rangeType,
				g.gangwei_name rangeName,
				g.organ_id organId,
				'' zhileiName
			FROM
				t_shigang_rule_range r
			LEFT JOIN t_gangwei g ON r.`range` = g.id
			LEFT JOIN t_shigang_rule sr ON r.rule_id = sr.id
			WHERE
				r.range_type = 2
			AND r.rule_id =:ruleId
			AND sr.`status` != 5
			UNION
			SELECT
				r.rule_id ruleId,
				r.`range`,
				r.range_type rangeType,
				z.zhiwei_name rangeName,
				'' organId,
				zl.zhiwei_name zhileiName
			FROM
				t_shigang_rule_range r
			LEFT JOIN t_zhiwei z ON r.`range` = z.id
			LEFT JOIN t_shigang_rule sr ON r.rule_id = sr.id
			LEFT JOIN t_zhiwei zl on zl.id=z.pid
			WHERE
				r.range_type = 3
			AND r.rule_id =:ruleId
			AND sr.`status` != 5
			UNION
			SELECT
				r.rule_id ruleId,
				r.`range`,
				r.range_type rangeType,
				o.organ_name rangeName,
				o.id organId,
				'' zhileiName
			FROM
				t_shigang_rule_range r
			LEFT JOIN t_organ o ON r.`range` = o.id
			LEFT JOIN t_shigang_rule sr ON r.rule_id = sr.id
			WHERE
				r.range_type = 4
			AND r.rule_id =:ruleId
			AND sr.`status` != 5
		]]>
	</sql>
	<sql id="getShigangRuleByRange" isRead="true">
		<![CDATA[
			select p.* from t_shigang_rule p left join t_shigang_rule_range r
			on p.id=r.rule_id
			where p.company_id = :companyId
			and p.status = 0
			<#if range?? && range?length gt 0>
				and `range` = :range
			</#if>
			<#if rangeType?? && rangeType?length gt 0>
				and range_type = :rangeType
			</#if>
		]]>
	</sql>
	<sql id="getJiediaoRuleByParam" isRead="true">
		<![CDATA[
			select * from t_jiediao_rule
			where 1=1
			<#if id?? && id?length gt 0>
				and id =:id
			</#if>
			<#if companyId?? && companyId?length gt 0>
				and company_id =:companyId
			</#if>
			<#if organId?? && organId?length gt 0>
				and organ_id =:organId
			</#if>
		]]>
	</sql>
	<sql id="getDiaoDongRuleByParam" isRead="true">
		<![CDATA[
			select * from t_diaodong_rule
			where 1=1
			<#if id?? && id?length gt 0>
				and id =:id
			</#if>
			<#if companyId?? && companyId?length gt 0>
				and company_id =:companyId
			</#if>
		]]>
	</sql>
	<sql id="getEnterRuleByParam" isRead="true">
		<![CDATA[
			select * from t_enter_rule
			where 1=1
			<#if id?? && id?length gt 0>
				and id =:id
			</#if>
			<#if companyId?? && companyId?length gt 0>
				and company_id =:companyId
			</#if>
		]]>
	</sql>
	<sql id="getContractNoRuleByCompanyId" isRead="true">
		<![CDATA[
			select * from t_contractno_rule
			where 1=1
			<#if companyId?? && companyId?length gt 0>
				and company_id =:companyId
			</#if>
		]]>
	</sql>
	
	<sql id="getShiyongqiRuleByZhiweiId" isRead="true">
		<![CDATA[
			select * from t_shiyongqi_rule
			where 1=1
			<#if zhiweiId?? && zhiweiId?length gt 0>
				and zhiwei_id =:zhiweiId
			</#if>
		]]>
	</sql>
	<sql id="getWorkStatusDisplayByOrganId" isRead="true">
		<![CDATA[
			select * from t_work_status_display
			where 1=1
			<#if organId?? && organId?length gt 0>
				and organ_id =:organId
			</#if>
		]]>
	</sql>
	<sql id="getBlacklistRuleByOrganId" isRead="true">
		<![CDATA[
			select * from t_blacklist_rule
			where 1=1
			<#if organId?? && organId?length gt 0>
				and organ_id =:organId
			</#if>
			and company_id = :companyId
		]]>
	</sql>
	<sql id="getShigangRulePage" isRead="true">
		<![CDATA[
			SELECT
				r.id,
				r.company_id companyId,
				shigang_days shigangDays,
				plan_name planName,
				r.`status`,
				pass_type passType,
				r.create_date createDate,
				u.user_name createUserName
			FROM
				t_shigang_rule r left join wec_user u
				on r.create_uid = u.id
			WHERE
				r.STATUS != 5
			<#if planName?? && planName?length gt 0>
				and plan_name like concat('%',:planName,'%')
			</#if>
			<#if companyId?? && companyId?length gt 0>
				and r.company_id =:companyId
			</#if>
		]]>
	</sql>
	<sql id="checkRepeat" isRead="true">
		<![CDATA[
			SELECT
			count(1)
		FROM
			t_shigang_rule_range ra
		LEFT JOIN t_shigang_rule r ON ra.rule_id = r.id
		WHERE
			ra.company_id = :companyId
			and r.`status` = 0
			<#if list?? && list?size gt 0>
				AND `range` IN (:list)
			</#if>
			<#if notRuleId?? && notRuleId?length gt 0>
				AND rule_id != :notRuleId
			</#if>
		]]>
	</sql>
	<sql id="deleteRange">
		<![CDATA[
			delete from t_shigang_rule_range where 1=1
			<#if ruleId?? && ruleId?length gt 0>
				AND rule_id = :notRuleId
			</#if>
		]]>
	</sql>
	<sql id="getSeniorityRuleEntityByOrganId" isRead="true">
		<![CDATA[
			select * from t_seniority_rule where company_id=:companyId
			<#if organId?? && organId?length gt 0>
				and organ_id=:organId
			</#if>
		]]>
	</sql>
	<sql id="findSeniorityRuleByCompanyId" isRead="true">
		<![CDATA[
			select * from t_seniority_rule where company_id=:companyId
		]]>
	</sql>
	<sql id="getZjzlRule" isRead="true">
		<![CDATA[
			SELECT
				*
			FROM
				t_company_global_perm
			WHERE
				company_id =:companyId
			AND key_name IN (
				'idcard_photo_required',
				'work_photo_required',
				'education_file_required',
				'health_certificate_required',
				'zhiyezigezheng_required'
			)
		]]>
	</sql>
	<sql id="updateZjzlRule">
		<![CDATA[
			update t_company_global_perm
			set value=:value
			WHERE company_id =:companyId
			and key_name=:keyName
		]]>
	</sql>
	<sql id="deleteShigangRulePlanRange">
		<![CDATA[
			delete  from t_shigang_rule_range where rule_id=:ruleId
		]]>
	</sql>
</sqlMap>

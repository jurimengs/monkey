<?xml version="1.0" encoding="UTF-8" ?>
<sqlMap namespace="HouqinSusheFeiyong">
    <!--根据宿舍Id和月份查询记录-->
    <sql id="queryBysusheIdAndMonth" isRead="true">
        <![CDATA[
        SELECT
        t.*
        FROM
        t_houqin_sushe_feiyong t
        WHERE
        t.sushe_id =:susheId
        AND t.`month` =:month
        ]]>
    </sql>


    <!--分页查询水电费记录-->
    <sql id="shuidianfeipageQuery" isRead="true">
        <![CDATA[
        SELECT
        thsf.id,
        ths.`name`,
        thsf.`month`,
        thsf.dian_fei,
        thsf.shui_fei,
        thsf.qita_fei
        FROM
        t_houqin_sushe_feiyong thsf
        LEFT JOIN t_houqin_sushe ths ON thsf.sushe_id = ths.id
        LEFT JOIN t_houqin_sushe_range thsr ON thsr.sushe_id = thsf.sushe_id
        LEFT JOIN t_organ o ON o.id = thsr.organ_id
        where thsf.comapny_id=:companyId
         <#if keyword?? && keyword?length gt 0>
                    and ths.name like concat('%',:keyword,'%')
         </#if>
        <#if dataRange??  && dataRange?length gt 0>
            ${dataRange}
        </#if>
        group by thsf.id
        order by thsf.`month` desc
        ]]>
    </sql>

    <!--分页查询用户费用信息-->
    <sql id="pageQuery" isRead="true">
        <![CDATA[
        SELECT
        thuf.id,
        w.emp_no empNo,
        w.user_name userName,
        o.organ_name organName,
        thuf.ruzhu_days ruzhuDays,
        thuf.`month`,
        thuf.`begin_date` beginDate,
        thuf.`end_date` endDate,
        ths.`name` susheName,
        thsf.room_name fangjianName,
        thc.chuangwei_name chuangweiName,
        thuf.avg_zhusu_fei avgZhusuFei,
        thuf.avg_shuidian_fei avgShuidianFei,
        thuf.avg_qita_fei avgQitaFei,
        thuf.total_fei totalFei
        FROM
        t_houqin_user_feiyong thuf
        LEFT JOIN wec_user w ON thuf.user_id = w.id
        LEFT JOIN t_organ o ON o.id = w.organ_id
        LEFT JOIN t_houqin_sushe ths ON ths.id = thuf.sushe_id
        LEFT JOIN t_houqin_sushe_fangjian thsf ON thsf.id = thuf.fangjian_id
        LEFT JOIN t_houqin_chuangwei thc ON thc.id = thuf.chaugnwei_id
        where thuf.company_id=:companyId
        <#if keyword?? && keyword?length gt 0>
                    AND (w.user_name like concat('%', :keyword, '%')
                        OR tor.organ_name like concat('%', :keyword, '%')
                        OR w.emp_no like concat('%', :keyword, '%')
                        OR tc.goods_name like concat('%', :keyword, '%')
                        )
        </#if>
        <#if dataRange??  && dataRange?length gt 0>
            ${dataRange}
        </#if>
        <#if organPaths?? && organPaths?length gt 0>
                    AND o.organ_paths like CONCAT (:organPaths,'%')
        </#if>
        <#if month?? && month?length gt 0>
                    AND thuf.month=:month
        </#if>
        order by thuf.`month` desc

        ]]>
    </sql>


    <!--根据宿舍Id和月份查询导入的宿舍费用信息-->
    <sql id="queryByMonthAndSusheId" isRead="true">
        <![CDATA[
        SELECT
        t.*
        FROM
        t_houqin_sushe_feiyong t
        WHERE
        t.sushe_id =:susheId
        AND t.`month` =:month
        ORDER BY
        t.create_date DESC
        ]]>
    </sql>


</sqlMap>

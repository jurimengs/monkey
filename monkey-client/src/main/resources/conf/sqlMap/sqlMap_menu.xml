<?xml version="1.0" encoding="UTF-8" ?>
<sqlMap namespace="Menu">
     <!-- 根据登录用户角色企业获取菜单树 -->
    <sql id="findMenuByLoginRole" isRead="true">
        <![CDATA[
            SELECT DISTINCT
                m.id AS id,
                m.menu_name AS menuName,
                m.menu_code AS menuCode,
                m.pid AS pid,
                m.sort AS sort,
                m.create_date AS createDate
            FROM
                t_menu m
            LEFT JOIN (
                SELECT
                    id,
                    company_id,
                    auth_flag
                FROM
                    wec_permission_function
                WHERE 1 = 1
                    <#if functionType?? && functionType?length gt 0>
                        AND function_type = :functionType
                    </#if>
            ) AS pf ON m.menu_code = pf.auth_flag
            LEFT JOIN wec_role_permission rp ON rp.permission_id = pf.id
            WHERE 1 = 1
	            <#if companyId?? && companyId?length gt 0>
	                AND rp.company_id = :companyId
	            </#if>
                <#if roleIdList?? && roleIdList?size gt 0>
                    AND rp.role_id in  (
                        <#list roleIdList as id>
                            '${id}'
                            <#if id_has_next>,</#if>
                        </#list>
                    )
                </#if>
        ]]>
    </sql>
    <sql id="findMenuVoGrade" isRead="true">
        <![CDATA[
            SELECT 
                m.id AS id,
                m.menu_name AS menuName,
                m.menu_code AS menuCode,
                m.pid AS pid,
                m.sort AS sort,
                m.create_date AS createDate
            FROM
                t_menu m
            ORDER BY pid asc,sort;
        ]]>
    </sql>
    <sql id="findMenuAll" isRead="true">
        <![CDATA[
            SELECT * FROM t_menu m
        ]]>
    </sql>
    <sql id="findMenusNoGradeTop" isRead="true">
        <![CDATA[
            SELECT 
                m.id AS id,
                m.menu_name AS menuName,
                m.menu_code AS menuCode,
                m.pid AS pid,
                m.sort AS sort 
            FROM
                t_menu m
                where m.pid <> 0 and m.menu_show = 0
        ]]>
    </sql>
</sqlMap>
